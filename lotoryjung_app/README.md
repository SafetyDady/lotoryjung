# üé∞ Lotoryjung - Advanced Lottery Management System

‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≠‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Flask framework ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô

## üöÄ Features Overview

### üéØ Core Functionality
- **User Authentication System** - ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
- **Order Management** - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡∏≠‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà
- **Admin Dashboard** - ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
- **Audit Logging** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏∞‡∏ö‡∏ö

### üîí Blocked Numbers Management
- **Bulk Operations** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
- **Auto-detection** - ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß
- **Permutation Generation** - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **Advanced Search & Filter** - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á

### üìä Limits Management System

#### Group Limits (‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°)
- **Default Limits Setting** - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
- **Real-time Usage Tracking** - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
- **Visual Progress Bars** - ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á
- **Automated Limit Validation** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

#### Individual Number Limits (‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß) ‚≠ê
- **Granular Control** - ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏•‡∏Ç‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß
- **Priority-based Validation** - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
- **CRUD Operations** - ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö ‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏•‡∏Ç
- **Override Default Limits** - ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ

### üõ°Ô∏è Security Features
- **CSRF Protection** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ Cross-Site Request Forgery
- **Admin Authorization** - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
- **Input Validation** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
- **SQL Injection Prevention** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏à‡∏°‡∏ï‡∏µ SQL Injection

## üèóÔ∏è System Architecture

### üìã Validation Priority Logic
```
Priority 1: Blocked Numbers Check
    ‚îú‚îÄ‚îÄ If blocked ‚Üí 0.5x payout rate
    ‚îî‚îÄ‚îÄ If not blocked ‚Üí Continue

Priority 2: Individual Limits Check  
    ‚îú‚îÄ‚îÄ If individual limit exists ‚Üí Use individual limit
    ‚îî‚îÄ‚îÄ If no individual limit ‚Üí Continue

Priority 3: Default Group Limits
    ‚îî‚îÄ‚îÄ Apply default group limit for field type
```

### üé≤ Field Types Supported
- **2_top** (2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô) - 2-digit top lottery
- **2_bottom** (2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á) - 2-digit bottom lottery  
- **3_top** (3 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô) - 3-digit top lottery
- **tote** (‡πÇ‡∏ï‡πä‡∏î) - Tote betting

### üíæ Database Schema
```sql
-- Core tables
user                 -- User authentication
order               -- Lottery orders
order_item          -- Individual lottery bets
blocked_number      -- Blocked lottery numbers
rule                -- Both group and individual limits
number_total        -- Usage tracking
audit_log          -- Change tracking
```

## üöÄ Quick Start

### Prerequisites
- Python 3.8+
- SQLite3 (included in Python)
- Flask and dependencies (see requirements.txt)

### Installation
```bash
# Clone repository
git clone https://github.com/SafetyDady/lotoryjung.git
cd lotoryjung_app

# Install dependencies
pip install -r requirements.txt

# Initialize database
python init_db.py

# Initialize default limits
python init_limits.py

# Start server
python run_server.py
```

### Default Access
- **URL**: http://127.0.0.1:8080
- **Admin Login**: admin / admin123
- **Test User**: testuser / test123

## üì± Admin Panel Features

### üè† Dashboard
- System statistics overview
- Recent orders display
- Quick access buttons
- Performance metrics

### üö´ Blocked Numbers Management
- **URL**: `/admin/blocked_numbers`
- Bulk add/edit/delete operations
- Auto-permutation generation
- Search and filtering capabilities

### üìä Group Limits Management  
- **URL**: `/admin/group_limits`
- Default limits configuration
- Real-time usage monitoring
- Visual progress indicators

### üéØ Individual Limits Management ‚≠ê
- **URL**: `/admin/individual_limits`
- Granular number-specific limits
- Override default group limits
- Advanced filtering and search
- Modal-based CRUD operations

## üîß API Endpoints

### Individual Limits APIs
```http
# Set/Update Individual Limit
POST /admin/api/set_individual_limit
Content-Type: application/json
X-CSRFToken: <token>

{
    "field": "2_top",
    "number_norm": "12", 
    "limit_amount": 500
}

# Delete Individual Limit
POST /admin/api/delete_individual_limit
Content-Type: application/json
X-CSRFToken: <token>

{
    "field": "2_top",
    "number_norm": "12"
}
```

### Group Limits APIs
```http
# Update Group Limit
POST /admin/api/update_group_limit
Content-Type: application/json

{
    "field": "2_top",
    "limit": 1000000
}

# Get Dashboard Data
GET /admin/group_limits/api/dashboard_data?batch_id=20250902
```

## üé® Frontend Technologies

- **Bootstrap 5.3.0** - UI framework
- **Font Awesome** - Icons
- **jQuery** - AJAX operations  
- **JavaScript ES6** - Modern JavaScript features
- **Jinja2** - Template engine

## üîç Usage Examples

### Adding Individual Limit
```python
from app.services.limit_service import LimitService

# Set limit of 500 for number "12" in 2_top category
success = LimitService.set_individual_limit("2_top", "12", 500)
```

### Validating Order
```python
# Validate order with priority logic
result = LimitService.validate_order_item("2_top", "12", 300)
print(f"Payout rate: {result['payout_rate']}x")
print(f"Status: {result['reason']}")
```

### Getting Current Usage
```python
# Get current usage for specific number
usage = LimitService.get_current_usage("2_top", "12", "20250902")
print(f"Current usage: {usage} ‡∏ö‡∏≤‡∏ó")
```

## üìà System Monitoring

### Performance Metrics
- Order processing speed
- Database query optimization
- Memory usage tracking
- Real-time user activity

### Audit Trail
- All admin actions logged
- User authentication tracking
- Limit changes monitoring
- System configuration changes

## üõ†Ô∏è Development Tools

### Debugging Features
- Flask debug mode
- Server-side logging
- JavaScript console logging
- Database query monitoring

### Testing Capabilities
- Manual testing tools
- API endpoint testing
- Database integrity checks
- Security validation tests

## üìñ Documentation

### Available Documents
- **[INDIVIDUAL_LIMITS_DESIGN.md](docs/INDIVIDUAL_LIMITS_DESIGN.md)** - Individual limits system design
- **[GROUP_LIMITS_DESIGN.md](docs/GROUP_LIMITS_DESIGN.md)** - Group limits system design  
- **[STRUCTURE.md](docs/STRUCTURE.md)** - Project structure overview
- **[PROGRESS.md](docs/PROGRESS.md)** - Development progress log
- **[INSTALLATION.md](docs/INSTALLATION.md)** - Installation guide

## üöß Future Enhancements

### Planned Features
- [ ] Mobile app API endpoints
- [ ] CSV/Excel export functionality
- [ ] Advanced analytics dashboard
- [ ] Multi-language support
- [ ] Bulk individual limits operations
- [ ] Time-based limit rules
- [ ] API rate limiting
- [ ] Real-time notifications

### System Improvements
- [ ] Database connection pooling
- [ ] Caching layer implementation
- [ ] Background job processing
- [ ] Microservices architecture
- [ ] Container deployment (Docker)

## ü§ù Contributing

### Development Guidelines
1. Follow PEP 8 style guidelines
2. Write comprehensive tests
3. Update documentation
4. Use meaningful commit messages

### Code Structure
- **Models**: Database layer (`app/models/`)
- **Services**: Business logic (`app/services/`)
- **Routes**: Controller layer (`app/routes/`)
- **Templates**: View layer (`templates/`)
- **Static**: Frontend assets (`static/`)

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.

## üÜò Support & Troubleshooting

### Common Issues
- **CSRF Token Errors**: Ensure AJAX requests include CSRF token
- **Template Rendering**: Check Jinja2 syntax and function usage
- **Database Errors**: Verify database initialization and migrations
- **Permission Issues**: Confirm admin user authentication

### Getting Help
- Check documentation in `/docs` folder
- Review server logs for detailed error messages
- Test API endpoints individually
- Verify database schema integrity

---

## üìä System Status

**Current Version**: 2.0  
**Last Updated**: September 2, 2025  
**Status**: Production Ready with Individual Limits ‚úÖ

### Feature Completeness
- ‚úÖ User Authentication System
- ‚úÖ Order Management  
- ‚úÖ Blocked Numbers Management
- ‚úÖ Group Limits Management
- ‚úÖ Individual Limits Management
- ‚úÖ Admin Dashboard
- ‚úÖ Security Implementation
- ‚úÖ API Endpoints
- ‚úÖ Documentation

**üéâ Ready for production use with comprehensive lottery management capabilities!**
