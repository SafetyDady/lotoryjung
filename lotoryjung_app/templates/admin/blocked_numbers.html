{% extends "admin/base.html" %}

{% block title %}‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-ban me-2 text-danger"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô
                    </h2>
                    <p class="text-muted mb-0">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ó‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                </div>
                <div>
                    <a href="{{ url_for('admin.bulk_add_blocked_numbers') }}" class="btn btn-success me-2">
                        <i class="fas fa-table me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß
                    </a>
                    <a href="{{ url_for('admin.add_blocked_number') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-danger text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">{{ stats.total or 0 }}</h4>
                            <p class="card-text">‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-ban fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">{{ stats.by_field.get('2_top', 0) + stats.by_field.get('2_bottom', 0) }}</h4>
                            <p class="card-text">2 ‡∏´‡∏•‡∏±‡∏Å</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-hashtag fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">{{ stats.by_field.get('3_top', 0) }}</h4>
                            <p class="card-text">3 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-list-ol fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">{{ stats.by_field.get('tote', 0) }}</h4>
                            <p class="card-text">‡πÇ‡∏ï‡πä‡∏î</p>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-dice fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DEBUG INFO -->
    <div style="background-color: #ffeb3b; padding: 10px; margin-bottom: 20px; border-radius: 4px;">
        <strong>üîç DEBUG:</strong>
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {{ blocked_numbers.items|length if blocked_numbers and blocked_numbers.items else 0 }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    </div>

    {% if blocked_numbers and blocked_numbers.items %}
        <!-- Group blocked numbers by field -->
        {% set numbers_2_top = [] %}
        {% set numbers_2_bottom = [] %}
        {% set numbers_3_top = [] %}
        {% set numbers_tote = [] %}
        
        {% for blocked in blocked_numbers.items %}
            {% if blocked.field == '2_top' %}
                {% set _ = numbers_2_top.append(blocked) %}
            {% elif blocked.field == '2_bottom' %}
                {% set _ = numbers_2_bottom.append(blocked) %}
            {% elif blocked.field == '3_top' %}
                {% set _ = numbers_3_top.append(blocked) %}
            {% elif blocked.field == 'tote' %}
                {% set _ = numbers_tote.append(blocked) %}
            {% endif %}
        {% endfor %}

        <!-- Column Layout Table -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <!-- Header Row -->
                        <thead>
                            <tr>
                                {% if numbers_2_top %}
                                <th class="text-center bg-info text-white" style="width: 25%;">
                                    <i class="fas fa-hashtag me-2"></i>2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                                </th>
                                {% endif %}
                                {% if numbers_2_bottom %}
                                <th class="text-center bg-warning text-dark" style="width: 25%;">
                                    <i class="fas fa-hashtag me-2"></i>2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                                </th>
                                {% endif %}
                                {% if numbers_3_top %}
                                <th class="text-center bg-success text-white" style="width: 25%;">
                                    <i class="fas fa-list-ol me-2"></i>3 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                                </th>
                                {% endif %}
                                {% if numbers_tote %}
                                <th class="text-center bg-primary text-white" style="width: 25%;">
                                    <i class="fas fa-dice me-2"></i>‡πÇ‡∏ï‡πä‡∏î ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                                </th>
                                {% endif %}
                            </tr>
                        </thead>
                        <!-- Body -->
                        <tbody>
                            {% set max_rows = [numbers_2_top|length, numbers_2_bottom|length, numbers_3_top|length, numbers_tote|length]|max %}
                            {% for i in range(max_rows) %}
                            <tr>
                                {% if numbers_2_top %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_2_top|length %}
                                        {% set blocked = numbers_2_top[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-info mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <a href="{{ url_for('admin.edit_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-primary" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-danger" title="‡∏•‡∏ö"
                                                   onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô {{ blocked.number_norm }} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}
                                
                                {% if numbers_2_bottom %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_2_bottom|length %}
                                        {% set blocked = numbers_2_bottom[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-warning mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <a href="{{ url_for('admin.edit_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-primary" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-danger" title="‡∏•‡∏ö"
                                                   onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô {{ blocked.number_norm }} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}

                                {% if numbers_3_top %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_3_top|length %}
                                        {% set blocked = numbers_3_top[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-success mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <a href="{{ url_for('admin.edit_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-primary" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-danger" title="‡∏•‡∏ö"
                                                   onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô {{ blocked.number_norm }} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}

                                {% if numbers_tote %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_tote|length %}
                                        {% set blocked = numbers_tote[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-primary mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <a href="{{ url_for('admin.edit_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-primary" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" 
                                                   class="btn btn-sm btn-outline-danger" title="‡∏•‡∏ö"
                                                   onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô {{ blocked.number_norm }} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    {% else %}
        <!-- No Data Card -->
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="fas fa-ban fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô</h5>
                <p class="text-muted">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏ó‡∏á</p>
                <a href="{{ url_for('admin.add_blocked_number') }}" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
