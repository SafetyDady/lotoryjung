{% extends "admin/base.html" %}

{% block title %}จัดการเลขอั้น{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-ban me-2 text-danger"></i>จัดการเลขอั้น
                    </h2>
                    <p class="text-muted mb-0">เลขที่จ่ายครึ่ง</p>
                </div>
                <div>
                    <a href="{{ url_for('admin.bulk_add_blocked_numbers') }}" class="btn btn-success me-2">
                        <i class="fas fa-table me-1"></i>เปลี่ยนเลขอั้นทั้งกระดาน
                    </a>
                    <a href="{{ url_for('admin.add_blocked_number') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i>เพิ่มทีละตัว
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% if blocked_numbers and blocked_numbers.items %}
        <!-- Group blocked numbers by field -->
        {% set numbers_2_top = [] %}
        {% set numbers_2_bottom = [] %}
        {% set numbers_3_top = [] %}
        {% set numbers_tote = [] %}
        
        {% for blocked in blocked_numbers.items %}
            {% if blocked.field == '2_top' %}
                {% set _ = numbers_2_top.append(blocked) %}
            {% elif blocked.field == '2_bottom' %}
                {% set _ = numbers_2_bottom.append(blocked) %}
            {% elif blocked.field == '3_top' %}
                {% set _ = numbers_3_top.append(blocked) %}
            {% elif blocked.field == 'tote' %}
                {% set _ = numbers_tote.append(blocked) %}
            {% endif %}
        {% endfor %}

        <!-- Column Layout Table -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <!-- Header Row -->
                        <thead>
                            <tr>
                                {% if numbers_2_top %}
                                <th class="text-center bg-info text-white" style="width: 25%;">
                                    <i class="fas fa-hashtag me-2"></i>2 ตัวบน ({{ numbers_2_top|length }} รายการ)
                                </th>
                                {% endif %}
                                {% if numbers_2_bottom %}
                                <th class="text-center bg-warning text-dark" style="width: 25%;">
                                    <i class="fas fa-hashtag me-2"></i>2 ตัวล่าง ({{ numbers_2_bottom|length }} รายการ)
                                </th>
                                {% endif %}
                                {% if numbers_3_top %}
                                <th class="text-center bg-success text-white" style="width: 25%;">
                                    <i class="fas fa-list-ol me-2"></i>3 ตัวบน ({{ numbers_3_top|length }} รายการ)
                                </th>
                                {% endif %}
                                {% if numbers_tote %}
                                <th class="text-center bg-primary text-white" style="width: 25%;">
                                    <i class="fas fa-dice me-2"></i>โต๊ด ({{ numbers_tote|length }} รายการ)
                                </th>
                                {% endif %}
                            </tr>
                        </thead>
                        <!-- Body -->
                        <tbody>
                            {% set max_rows = [numbers_2_top|length, numbers_2_bottom|length, numbers_3_top|length, numbers_tote|length]|max %}
                            {% for i in range(max_rows) %}
                            <tr>
                                {% if numbers_2_top %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_2_top|length %}
                                        {% set blocked = numbers_2_top[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-info mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <form method="POST" action="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" class="d-inline">
                                                    {{ delete_form.hidden_tag() }}
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="ลบ"
                                                            onclick="return confirm('ต้องการลบเลขอั้น {{ blocked.number_norm }} หรือไม่?')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}
                                
                                {% if numbers_2_bottom %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_2_bottom|length %}
                                        {% set blocked = numbers_2_bottom[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-warning mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <form method="POST" action="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" class="d-inline">
                                                    {{ delete_form.hidden_tag() }}
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="ลบ"
                                                            onclick="return confirm('ต้องการลบเลขอั้น {{ blocked.number_norm }} หรือไม่?')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}

                                {% if numbers_3_top %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_3_top|length %}
                                        {% set blocked = numbers_3_top[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-success mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <form method="POST" action="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" class="d-inline">
                                                    {{ delete_form.hidden_tag() }}
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="ลบ"
                                                            onclick="return confirm('ต้องการลบเลขอั้น {{ blocked.number_norm }} หรือไม่?')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}

                                {% if numbers_tote %}
                                <td class="text-left" style="vertical-align: middle; padding: 10px;">
                                    {% if i < numbers_tote|length %}
                                        {% set blocked = numbers_tote[i] %}
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="text-primary mb-0">{{ blocked.number_norm }}</h5>
                                            <div class="d-flex gap-1">
                                                <form method="POST" action="{{ url_for('admin.delete_blocked_number', id=blocked.id) }}" class="d-inline">
                                                    {{ delete_form.hidden_tag() }}
                                                    <button type="submit" class="btn btn-sm btn-outline-danger" title="ลบ"
                                                            onclick="return confirm('ต้องการลบเลขอั้น {{ blocked.number_norm }} หรือไม่?')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    {% endif %}
                                </td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    {% else %}
        <!-- No Data Card -->
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="fas fa-ban fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">ยังไม่มีเลขอั้น</h5>
                <p class="text-muted">เริ่มต้นด้วยการเพิ่มเลขที่ต้องการห้ามแทง</p>
                <a href="{{ url_for('admin.add_blocked_number') }}" class="btn btn-primary">
                    <i class="fas fa-plus me-1"></i>เพิ่มเลขอั้น
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
