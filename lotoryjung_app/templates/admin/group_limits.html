{% extends "admin/base.html" %}

{% block title %}จัดการขีดจำกัดกลุ่มเลข{% endblock %}

{% block content %}
<div class="container-fluid">
    <h2>จัดการขีดจำกัดกลุ่มเลข</h2>
    <p class="text-muted">ติดตามเลขที่มีความเสี่ยง - แต่ละเลขจำกัดอิสระ</p>
    
    <div class="row">
        {% for field, data in dashboard_data.items() %}
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5>{{ data.field_name }}</h5>
                    <small>ขีดจำกัด: {{ "{:,.0f}".format(data.default_limit) }} บาท</small>
                </div>
                <div class="card-body">
                    <p><strong>เลขเกินขีด:</strong> {{ data.exceeded_count }} เลข</p>
                    <p><strong>เลขใกล้เต็ม:</strong> {{ data.risky_count }} เลข</p>
                    <p><strong>จำนวนออเดอร์:</strong> {{ data.total_orders }}</p>
                    <p><strong>จำนวนหมายเลข:</strong> {{ data.total_numbers }}</p>
                    
                    {% if data.exceeded_numbers %}
                        <h6 class="text-danger">TOP ยอดเกิน Limit:</h6>
                        {% for num in data.exceeded_numbers %}
                        <div class="text-danger">{{ loop.index }}. <strong>{{ num.number }}</strong> = {{ "{:,.0f}".format(num.amount) }} บาท</div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
