# Permutation System Documentation
## ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô (Blocked Numbers)

### üìã Overview
‡∏£‡∏∞‡∏ö‡∏ö Permutation ‡πÉ‡∏ô Lotoryjung App ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ô‡∏±‡πâ‡∏ô

### üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
1. **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•** - ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
2. **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°** - ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ö‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å
3. **‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û** - ‡∏™‡∏£‡πâ‡∏≤‡∏á permutations ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡∏•‡∏∞‡∏ï‡∏±‡∏ß

---

## üî¢ ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### ‡πÄ‡∏•‡∏Ç 2 ‡∏´‡∏•‡∏±‡∏Å (2-digit Numbers)
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 2 ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô `12` ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á:

#### Permutations ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:
- `12` (‡πÄ‡∏•‡∏Ç‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö)
- `21` (‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)

#### ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÑ‡∏õ‡∏¢‡∏±‡∏á Fields:
```
INPUT: 12 (2_digit)
OUTPUT:
‚îú‚îÄ‚îÄ 2_top: [12, 21]     # 2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô
‚îî‚îÄ‚îÄ 2_bottom: [12, 21]  # 2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
```javascript
generatePermutations("12", "2_digit")
// ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
[
  {field: "2_top", number_norm: "12"},
  {field: "2_top", number_norm: "21"},
  {field: "2_bottom", number_norm: "12"},
  {field: "2_bottom", number_norm: "21"}
]
```

---

### ‡πÄ‡∏•‡∏Ç 3 ‡∏´‡∏•‡∏±‡∏Å (3-digit Numbers)
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 3 ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏ä‡πà‡∏ô `123` ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á:

#### Permutations ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:
- `123` (‡πÄ‡∏•‡∏Ç‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö)
- `132` (‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 2,3)
- `213` (‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 1,2)
- `231` (‡∏´‡∏°‡∏∏‡∏ô‡∏Ç‡∏ß‡∏≤)
- `312` (‡∏´‡∏°‡∏∏‡∏ô‡∏ã‡πâ‡∏≤‡∏¢)
- `321` (‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢)

#### ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÑ‡∏õ‡∏¢‡∏±‡∏á Fields:
```
INPUT: 123 (3_digit)
OUTPUT:
‚îú‚îÄ‚îÄ 3_top: [123, 132, 213, 231, 312, 321]  # 3 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô (6 permutations)
‚îî‚îÄ‚îÄ tote: [123]                            # ‡πÇ‡∏ï‡πä‡∏î (‡πÄ‡∏•‡∏Ç‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
```javascript
generatePermutations("123", "3_digit")
// ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:
[
  {field: "3_top", number_norm: "123"},
  {field: "3_top", number_norm: "132"},
  {field: "3_top", number_norm: "213"},
  {field: "3_top", number_norm: "231"},
  {field: "3_top", number_norm: "312"},
  {field: "3_top", number_norm: "321"},
  {field: "tote", number_norm: "123"}
]
```

---

## üõ†Ô∏è Implementation Details

### Core Function: `generate_blocked_numbers_for_field()`
**Location:** `/app/utils/number_utils.py`

```python
def generate_blocked_numbers_for_field(number, number_type):
    """
    ‡∏™‡∏£‡πâ‡∏≤‡∏á blocked numbers ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    
    Args:
        number (str): ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á permutations
        number_type (str): ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏•‡∏Ç ("2_digit" ‡∏´‡∏£‡∏∑‡∏≠ "3_digit")
        
    Returns:
        List[Dict]: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ records ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á database
    """
```

### Algorithm Flow:
1. **Input Validation** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
2. **Generate Permutations** - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
3. **Field Assignment** - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î field ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏•‡∏Ç
4. **Format Output** - ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö database

---

## üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Bulk Add System

### Workflow:
1. **User Input** - ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° Bulk Add
2. **Validation** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏•‡∏Ç
3. **Clear Database** - ‡∏•‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
4. **Generate Permutations** - ‡∏™‡∏£‡πâ‡∏≤‡∏á permutations ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏•‡∏Ç
5. **Remove Duplicates** - ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ã‡πâ‡∏≥‡πÉ‡∏ô memory
6. **Batch Insert** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á database ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

### Bulk Add Example:
```javascript
Input: [
  {number: "12", type: "2_digit"},
  {number: "13", type: "2_digit"}, 
  {number: "123", type: "3_digit"}
]

Generated Records:
‚îú‚îÄ‚îÄ 2_top: [12, 21, 13, 31]           # 4 records
‚îú‚îÄ‚îÄ 2_bottom: [12, 21, 13, 31]        # 4 records  
‚îú‚îÄ‚îÄ 3_top: [123, 132, 213, 231, 312, 321]  # 6 records
‚îî‚îÄ‚îÄ tote: [123]                       # 1 record
Total: 15 records
```

---

## üîç Technical Specifications

### Database Schema:
```sql
CREATE TABLE blocked_numbers (
    id INTEGER PRIMARY KEY,
    field VARCHAR(20) NOT NULL,        -- '2_top', '2_bottom', '3_top', 'tote'
    number_norm VARCHAR(3) NOT NULL,   -- normalized number string
    reason TEXT,                       -- optional reason
    is_active BOOLEAN DEFAULT 1,      -- active status
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(field, number_norm)         -- prevent duplicates
);
```

### Field Mappings:
| Field | Description | Permutation Rules |
|-------|-------------|-------------------|
| `2_top` | 2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô | All 2! permutations |
| `2_bottom` | 2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á | All 2! permutations |  
| `3_top` | 3 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô | All 3! permutations |
| `tote` | ‡πÇ‡∏ï‡πä‡∏î | Original number only |

---

## üß™ Testing Examples

### Test Case 1: Single 2-digit
```python
result = generate_blocked_numbers_for_field("45", "2_digit")
expected = [
    {"field": "2_top", "number_norm": "45"},
    {"field": "2_top", "number_norm": "54"},
    {"field": "2_bottom", "number_norm": "45"},
    {"field": "2_bottom", "number_norm": "54"}
]
assert result == expected
```

### Test Case 2: Single 3-digit
```python
result = generate_blocked_numbers_for_field("987", "3_digit")
expected_count = 7  # 6 for 3_top + 1 for tote
assert len(result) == expected_count
assert len([r for r in result if r["field"] == "3_top"]) == 6
assert len([r for r in result if r["field"] == "tote"]) == 1
```

---

## üö® Edge Cases & Considerations

### 1. Duplicate Digits
- ‡πÄ‡∏•‡∏Ç `11` ‚Üí permutations: `[11]` (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
- ‡πÄ‡∏•‡∏Ç `112` ‚Üí permutations: `[112, 121, 211]` (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)

### 2. Leading Zeros
- ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 0 ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å normalize
- `012` ‚Üí `12` (treated as 2-digit)

### 3. Performance Optimization
- ‡πÉ‡∏ä‡πâ `itertools.permutations()` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
- Batch insert ‡πÅ‡∏ó‡∏ô individual inserts
- Memory-based duplicate filtering

---

## üîß Maintenance & Monitoring

### Logging:
- Debug logs ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô permutations ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á
- Error handling ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö invalid inputs
- Transaction rollback ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î error

### Performance Metrics:
- ‡πÄ‡∏•‡∏Ç 2 ‡∏´‡∏•‡∏±‡∏Å: ~0.1ms per number
- ‡πÄ‡∏•‡∏Ç 3 ‡∏´‡∏•‡∏±‡∏Å: ~0.5ms per number
- Bulk add 100 numbers: ~2-5 seconds

---

## üìö Related Documentation
- [API Documentation](API_DOCUMENTATION.md)
- [Database Design](DESIGN.md) 
- [Installation Guide](INSTALLATION.md)
- [System Structure](STRUCTURE.md)

---

## üéØ Summary
Permutation System ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏Ç‡∏≠‡∏±‡πâ‡∏ô ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÑ‡∏õ‡∏¢‡∏±‡∏á field ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏ß‡∏¢

**Key Benefits:**
- ‚úÖ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏î‡πâ‡∏ß‡∏¢ batch processing  
- ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô duplicate ‡∏î‡πâ‡∏ß‡∏¢ unique constraints
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô bulk add interface
